#!/bin/sh

# run B but then wait for the file to change.
# great to set as $EDITOR.
# if editing in acme, watch for the moment the window is closed.
# otherwise the notion of a file changing is a little weak.

if [ "$1" = "--" ]; then
	shift
fi

file=$(echo $1 | cut -d ':' -f 1)

stat=`ls -l $file`
B "$@"
echo editing "$@"

p=$(realpath $file)
win=$(9p read acme/index | awk -v p=$p '$0 ~ p {print $1}')
if [ "$win" -gt 0 ]; then
	9p read acme/log | sed -n "/$win del/q"
else
	while sleep 1
	do
		nstat=`ls -l $file`
		if [ "x$stat" != "x$nstat" ]
		then
			exit
		fi
	done
fi

