#!/bin/sh

# run B but then wait for the file to change.
# great to set as $EDITOR.
# if editing in acme, watch for the moment the window is closed.
# otherwise the notion of a file changing is a little weak.

file=$(echo $1 | cut -d ':' -f 1)

stat=`ls -l $file`
B "$@"
echo editing "$@"

p=$(realpath $file)
9p read acme/index | grep -q $p
if [ $? -eq 0 ]; then
	9p read acme/log 2> /dev/null | grep -q "del $p"
else
	while sleep 1
	do
		nstat=`ls -l $file`
		if [ "x$stat" != "x$nstat" ]
		then
			exit
		fi
	done
fi

